{# API #}
{%- set props = props | default([]) -%}
{%- set _class = props.class | default(null) -%}
{%- set _helperText = props.helperText | default(null) -%}
{%- set _id = props.id -%}
{%- set _isDisabled = props.isDisabled | default(false) | boolprop -%}
{%- set _isFluid = props.isFluid | default(false) | boolprop -%}
{%- set _isLabelHidden = props.isLabelHidden | default(false) | boolprop -%}
{%- set _isMultiline = props.isMultiline | default(false) | boolprop -%}
{%- set _isRequired = props.isRequired | default(false) | boolprop -%}
{%- set _label = props.label -%}
{%- set _message = props.message | default(null) -%}
{%- set _name = props.name | default(null) -%}
{%- set _placeholder = props.placeholder | default(null) -%}
{%- set _type = props.type | default('text') -%}
{%- set _validationState = props.validationState | default(null) -%}
{%- set _value = props.value | default(null) -%}

{# Extended API for TextArea #}
{%- set _rows = props.rows | default(null) -%}

{# Extended API for TextField #}
{%- set _hasPasswordToggle = props.hasPasswordToggle | default(false) | boolprop -%}
{%- set _inputWidth = props.inputWidth | default(null) -%}

{# Class names #}
{%- set _rootClassName = _spiritClassPrefix ~ _isMultiline ? 'TextArea' : 'TextField' -%}
{%- set _inputClassName = _rootClassName ~ '__input' -%}
{%- set _labelClassName = _rootClassName ~ '__label' -%}
{%- set _labelHiddenClassName = _isLabelHidden ? _rootClassName ~ '__label--hidden' : null -%}
{%- set _labelRequiredClassName = _isRequired ? _rootClassName ~ '__label--required' : null -%}
{%- set _messageClassName = _rootClassName ~ '__message' -%}
{%- set _passwordToggleButtonClassName = _rootClassName ~ '__passwordToggle__button' -%}
{%- set _passwordToggleClassName = _rootClassName ~ '__passwordToggle' -%}
{%- set _passwordToggleIconClassName = _rootClassName ~ '__passwordToggle__icon' -%}
{%- set _passwordToggleIconShownClassName = _rootClassName ~ '__passwordToggle__icon--shown' -%}
{%- set _passwordToggleIconHiddenClassName = _rootClassName ~ '__passwordToggle__icon--hidden' -%}
{%- set _rootDisabledClassName = _isDisabled ? _rootClassName ~ '--disabled' : null -%}
{%- set _rootFluidClassName = _isFluid ? _rootClassName ~ '--fluid' : null -%}
{%- set _rootValidationStateClassName = _validationState ? _rootClassName ~ '--' ~ _validationState : null -%}
{%- set _helperTextClassName = _rootClassName ~ '__helperText' -%}

{# Attributes #}
{%- set _disabledAttr = _isDisabled ? 'disabled' : null -%}
{%- set _placeholderAttr = _placeholder ? 'placeholder="' ~ _placeholder ~'"' : null -%}
{%- set _requiredAttr = _isRequired ? 'required' : null -%}
{%- set _valueAttr = _value ? 'value=' ~ _value : null -%}

{# Extended Attributes for TextArea #}
{%- set _rowsAttr = _rows ? 'rows="' ~ _rows ~ '"' : null -%}

{# Extended Attributes for TextField #}
{%- set _inputWidthAttr = _inputWidth ? 'size="' ~ _inputWidth ~ '"' : null -%}

{# Miscellaneous #}
{%- set _rootClassNames = [ _rootClassName, _rootDisabledClassName, _rootFluidClassName, _rootValidationStateClassName, _class ] -%}
{%- set _labelClassNames = [ _labelClassName, _labelHiddenClassName, _labelRequiredClassName ] -%}
{%- set _mainPropsWithoutId = props | filter((value, prop) => prop != 'id') -%}
{%- set _allowedAttributes = [ 'autocomplete' ] -%}

{# Deprecations #}
{% if _validationState is same as('error') %}
    {% deprecated _rootClassName ~ ': The "error" value for "validationState" property will be removed in the next major version. Use "danger" instead.' %}
{% endif %}
{% if _message and _validationState is same as(null) %}
    {% deprecated _rootClassName ~ ': `message` prop without `validationState` prop will be unsupported in the next version. Use `helperText` instead.' %}
{% endif %}

<div {{ mainProps(_mainPropsWithoutId) }} {{ classProp(_rootClassNames) }}>
    <label for="{{ _id }}" {{ classProp(_labelClassNames) }}>
        {{ _label | raw }}
    </label>
    {% if _isMultiline %}
        <textarea
            {{ inputProps(props, _allowedAttributes) }}
            id="{{ _id }}"
            name="{{ _name }}"
            class="{{ _inputClassName }}"
            {{ _rowsAttr | raw }}
            {{ _placeholderAttr | raw }}
            {{ _disabledAttr | raw }}
            {{ _requiredAttr | raw }}
        >
            {{ _value }} {# Intentionally without `raw` to prevent XSS. #}
        </textarea>
    {% else %}
        {% if _hasPasswordToggle %}
            <div class="TextField__passwordToggle">
                <input
                    {{ inputProps(props, _allowedAttributes) }}
                    type="password"
                    id="{{ _id }}"
                    name="{{ _name }}"
                    class="{{ _inputClassName }}"
                    {{ _disabledAttr | raw }}
                    {{ _inputWidthAttr | raw }}
                    {{ _placeholderAttr | raw }}
                    {{ _requiredAttr | raw }}
                    {{ _valueAttr | raw }}
                />
                <button
                    type="button"
                    class="{{ _passwordToggleButtonClassName }}"
                    role="switch"
                    aria-pressed="false"
                    aria-label="Show password"
                    data-toggle="password"
                >
                    <span class="{{ _passwordToggleIconClassName }} {{ _passwordToggleIconHiddenClassName }}">
                        <Icon name="visibility-on" />
                    </span>
                    <span class="{{ _passwordToggleIconClassName }} {{ _passwordToggleIconShownClassName }}">
                        <Icon name="visibility-off" />
                    </span>
                </button>
            </div>
        {% else %}
            <input
                {{ inputProps(props, _allowedAttributes) }}
                type="{{ _type }}"
                id="{{ _id }}"
                name="{{ _name }}"
                class="{{ _inputClassName }}"
                {{ _disabledAttr | raw }}
                {{ _inputWidthAttr | raw }}
                {{ _placeholderAttr | raw }}
                {{ _requiredAttr | raw }}
                {{ _valueAttr }} {# Intentionally without `raw` to prevent XSS. #}
            />
        {% endif %}
    {% endif %}
    {% if _helperText %}
        <div class="{{ _helperTextClassName }}">
            {{ _helperText | raw }}
        </div>
    {% endif %}
    {% if _message %}
        <div class="{{ _messageClassName }}">
            {{ _message | raw }}
        </div>
    {% endif %}
</div>
